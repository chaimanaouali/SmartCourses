{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="{% static 'img/apple-icon.png' %}">
  <link rel="icon" type="image/png" href="{% static 'img/favicon.png' %}">
  <title>Quiz Results - Educational Hub</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <link href="{% static 'css/nucleo-icons.css' %}" rel="stylesheet" />
  <link href="{% static 'css/nucleo-svg.css' %}" rel="stylesheet" />
  <link href="{% static 'css/argon-dashboard.css' %}" rel="stylesheet" />
</head>

<body class="g-sidenav-show bg-gray-100">
  <div class="min-height-300 bg-dark position-absolute w-100"></div>
  <aside class="sidenav bg-white navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4" id="sidenav-main">
    <div class="sidenav-header">
      <a class="navbar-brand m-0" href="{% url 'home' %}">
        <img src="{% static 'img/logo-ct-dark.png' %}" width="26px" height="26px" class="navbar-brand-img h-100" alt="main_logo">
        <span class="ms-1 font-weight-bold">Educational Hub</span>
      </a>
    </div>
    <hr class="horizontal dark mt-0">
    <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="{% url 'home' %}">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="ni ni-tv-2 text-dark text-sm opacity-10"></i>
            </div>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'quiz_app:quiz_list' %}">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="ni ni-paper-diploma text-dark text-sm opacity-10"></i>
            </div>
            <span class="nav-link-text ms-1">Quizzes</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{% url 'quiz_app:quiz_analytics' %}">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="ni ni-chart-bar-32 text-dark text-sm opacity-10"></i>
            </div>
            <span class="nav-link-text ms-1">Analytics</span>
          </a>
        </li>
      </ul>
    </div>
  </aside>

  <main class="main-content position-relative border-radius-lg">
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur" data-scroll="false">
      <div class="container-fluid py-1 px-3">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-white" href="{% url 'home' %}">Pages</a></li>
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-white" href="{% url 'quiz_app:quiz_list' %}">Quizzes</a></li>
            <li class="breadcrumb-item text-sm text-white active" aria-current="page">Results</li>
          </ol>
          <h6 class="font-weight-bolder text-white mb-0">Quiz Results & AI Analysis</h6>
        </nav>
      </div>
    </nav>

    <div class="container-fluid py-4">
      <!-- Score Summary -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card bg-gradient-{% if passed %}success{% else %}warning{% endif %}">
            <div class="card-body text-center">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h2 class="text-white mb-2">
                    {% if passed %}
                    ðŸŽ‰ Congratulations! You Passed!
                    {% else %}
                    ðŸ“š Keep Learning!
                    {% endif %}
                  </h2>
                  <h1 class="text-white mb-0">{{ score_percentage|floatformat:1 }}%</h1>
                  <p class="text-white opacity-8 mb-0">Your Score: {{ attempt.correct_answers }}/{{ attempt.total_questions }} correct answers</p>
                </div>
                <div class="col-md-4">
                  <div class="text-center">
                    <div class="icon icon-shape icon-lg bg-white shadow mx-auto mb-3">
                      {% if passed %}
                      <i class="ni ni-trophy text-success"></i>
                      {% else %}
                      <i class="ni ni-bulb-61 text-warning"></i>
                      {% endif %}
                    </div>
                    <h6 class="text-white mb-0">
                      {% if passed %}
                      Excellent Work!
                      {% else %}
                      Room for Improvement
                      {% endif %}
                    </h6>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Performance Metrics -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card">
            <div class="card-body text-center">
              <div class="icon icon-shape icon-lg bg-gradient-primary shadow mx-auto mb-3">
                <i class="ni ni-single-copy-04 text-white"></i>
              </div>
              <h4 class="text-primary mb-0">{{ attempt.correct_answers }}</h4>
              <p class="text-sm text-muted mb-0">Correct Answers</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body text-center">
              <div class="icon icon-shape icon-lg bg-gradient-success shadow mx-auto mb-3">
                <i class="ni ni-watch-time text-white"></i>
              </div>
              <h4 class="text-success mb-0">{{ attempt.time_taken|default:"N/A" }}</h4>
              <p class="text-sm text-muted mb-0">Minutes Taken</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body text-center">
              <div class="icon icon-shape icon-lg bg-gradient-info shadow mx-auto mb-3">
                <i class="ni ni-chart-bar-32 text-white"></i>
              </div>
              <h4 class="text-info mb-0">{{ quiz.passing_score }}%</h4>
              <p class="text-sm text-muted mb-0">Passing Score</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body text-center">
              <div class="icon icon-shape icon-lg bg-gradient-warning shadow mx-auto mb-3">
                <i class="ni ni-single-02 text-white"></i>
              </div>
              <h4 class="text-warning mb-0">{{ quiz.difficulty_level|title }}</h4>
              <p class="text-sm text-muted mb-0">Difficulty Level</p>
            </div>
          </div>
        </div>
      </div>

      <!-- AI Analysis -->
      <div class="row">
        <div class="col-md-8">
          <!-- AI Feedback -->
          <div class="card mb-4">
            <div class="card-header pb-0">
              <div class="d-flex justify-content-between align-items-center">
                <h6 class="mb-0">ðŸ¤– AI Analysis & Feedback</h6>
                <span class="badge badge-sm bg-gradient-primary">AI Generated</span>
              </div>
            </div>
            <div class="card-body">
              {% if attempt.ai_feedback %}
              <div class="alert alert-info">
                <i class="ni ni-bulb-61 me-2"></i>
                {{ attempt.ai_feedback }}
              </div>
              {% endif %}
              
              <!-- Strengths -->
              {% if attempt.strengths %}
              <div class="mb-3">
                <h6 class="text-success mb-2">
                  <i class="ni ni-check-bold me-1"></i>
                  Your Strengths
                </h6>
                <ul class="list-unstyled">
                  {% for strength in attempt.strengths %}
                  <li class="mb-1">
                    <i class="ni ni-check-bold text-success me-2"></i>
                    {{ strength }}
                  </li>
                  {% endfor %}
                </ul>
              </div>
              {% endif %}
              
              <!-- Areas for Improvement -->
              {% if attempt.weaknesses %}
              <div class="mb-3">
                <h6 class="text-warning mb-2">
                  <i class="ni ni-bulb-61 me-1"></i>
                  Areas for Improvement
                </h6>
                <ul class="list-unstyled">
                  {% for weakness in attempt.weaknesses %}
                  <li class="mb-1">
                    <i class="ni ni-bulb-61 text-warning me-2"></i>
                    {{ weakness }}
                  </li>
                  {% endfor %}
                </ul>
              </div>
              {% endif %}
              
              <!-- AI Recommendations -->
              {% if attempt.recommendations %}
              <div class="mb-3">
                <h6 class="text-info mb-2">
                  <i class="ni ni-send me-1"></i>
                  AI Recommendations
                </h6>
                <ul class="list-unstyled">
                  {% for recommendation in attempt.recommendations %}
                  <li class="mb-1">
                    <i class="ni ni-send text-info me-2"></i>
                    {{ recommendation }}
                  </li>
                  {% endfor %}
                </ul>
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Quiz Details -->
          <div class="card">
            <div class="card-header pb-0">
              <h6 class="mb-0">Quiz Information</h6>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <p class="text-sm mb-2">
                    <strong>Quiz:</strong> {{ quiz.title }}
                  </p>
                  <p class="text-sm mb-2">
                    <strong>Course:</strong> {{ quiz.course.title }}
                  </p>
                  <p class="text-sm mb-2">
                    <strong>Difficulty:</strong> {{ quiz.get_difficulty_level_display }}
                  </p>
                </div>
                <div class="col-md-6">
                  <p class="text-sm mb-2">
                    <strong>Completed:</strong> {{ attempt.completed_at|date:"M d, Y H:i" }}
                  </p>
                  <p class="text-sm mb-2">
                    <strong>Time Taken:</strong> {{ attempt.time_taken|default:"N/A" }} minutes
                  </p>
                  <p class="text-sm mb-2">
                    <strong>Quiz Type:</strong> 
                    {% if quiz.ai_generated %}
                    ðŸ¤– AI Generated
                    {% else %}
                    {{ quiz.get_quiz_type_display }}
                    {% endif %}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-4">
          <!-- Performance Chart -->
          <div class="card mb-4">
            <div class="card-header pb-0">
              <h6 class="mb-0">Performance Breakdown</h6>
            </div>
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="text-sm">Correct Answers</span>
                <span class="text-sm font-weight-bold text-success">{{ attempt.correct_answers }}</span>
              </div>
              <div class="progress mb-3" style="height: 8px;">
                <div class="progress-bar bg-gradient-success" role="progressbar" style="width: {{ score_percentage }}%"></div>
              </div>
              
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="text-sm">Incorrect Answers</span>
                <span class="text-sm font-weight-bold text-danger">{{ attempt.total_questions|add:"-"|add:attempt.correct_answers }}</span>
              </div>
              <div class="progress mb-3" style="height: 8px;">
                <div class="progress-bar bg-gradient-danger" role="progressbar" style="width: {% widthratio attempt.total_questions|add:"-"|add:attempt.correct_answers attempt.total_questions 100 %}%"></div>
              </div>
              
              <div class="text-center mt-3">
                <h4 class="text-{% if passed %}success{% else %}warning{% endif %} mb-0">{{ score_percentage|floatformat:1 }}%</h4>
                <p class="text-sm text-muted mb-0">Overall Score</p>
              </div>
            </div>
          </div>

          <!-- Next Steps -->
          <div class="card">
            <div class="card-header pb-0">
              <h6 class="mb-0">Next Steps</h6>
            </div>
            <div class="card-body">
              <div class="d-grid gap-2">
                {% if not passed %}
                <a href="{% url 'quiz_app:start_quiz' quiz.id %}" class="btn btn-warning btn-sm">
                  <i class="ni ni-refresh-02 me-1"></i>
                  Retake Quiz
                </a>
                {% endif %}
                
                <a href="{% url 'course_detail' quiz.course.id %}" class="btn btn-outline-primary btn-sm">
                  <i class="ni ni-single-copy-04 me-1"></i>
                  Review Course
                </a>
                
                <a href="{% url 'quiz_app:quiz_analytics' %}" class="btn btn-outline-info btn-sm">
                  <i class="ni ni-chart-bar-32 me-1"></i>
                  View Analytics
                </a>
                
                <a href="{% url 'quiz_app:quiz_list' %}" class="btn btn-outline-secondary btn-sm">
                  <i class="ni ni-paper-diploma me-1"></i>
                  More Quizzes
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="{% static 'js/core/popper.min.js' %}"></script>
  <script src="{% static 'js/core/bootstrap.min.js' %}"></script>
  <script src="{% static 'js/plugins/perfect-scrollbar.min.js' %}"></script>
  <script src="{% static 'js/plugins/smooth-scrollbar.min.js' %}"></script>
  <script src="{% static 'js/argon-dashboard.min.js' %}"></script>
</body>
</html>




